# 资源加载器快速开始

## 快速测试

### 1. 最简单的方式 - 运行测试场景

在浏览器控制台中运行：

```javascript
// 导入测试函数（在开发环境中已自动导入）
window.startSimpleTest();
```

或者带加载UI的版本：

```javascript
window.startTestWithUI();
```

### 2. 定义你的第一个场景

```typescript
import { defineScene } from './core';
import * as THREE from 'three';

// 定义场景
const myFirstScene = defineScene({
    id: 'my_first_scene',
    name: '我的第一个场景',
    resources: {
        // 暂时不加载任何资源
    },
    main: async (resources) => {
        // 创建Three.js场景
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer();
        
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('app')!.appendChild(renderer.domElement);
        
        // 创建一个立方体
        const geometry = new THREE.BoxGeometry();
        const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        const cube = new THREE.Mesh(geometry, material);
        scene.add(cube);
        
        camera.position.z = 5;
        
        // 动画
        function animate() {
            requestAnimationFrame(animate);
            cube.rotation.x += 0.01;
            cube.rotation.y += 0.01;
            renderer.render(scene, camera);
        }
        animate();
    }
});

// 启动场景
myFirstScene();
```

### 3. 加载资源的场景

```typescript
const sceneWithResources = defineScene({
    id: 'scene_with_resources',
    name: '带资源的场景',
    resources: {
        textures: {
            'myTexture': '/path/to/texture.jpg'
        },
        gltfModels: {
            'myModel': '/path/to/model.gltf'
        }
    },
    onLoadProgress: (loaded, total, percentage) => {
        console.log(`加载中: ${percentage}%`);
    },
    main: async (resources) => {
        // 获取加载的资源
        const texture = resources.get('myTexture');
        const model = resources.get('myModel');
        
        // 使用资源创建场景...
    }
});

sceneWithResources();
```

### 4. 使用加载UI

```typescript
import { defineScene, createLoadingUI } from './core';

const loadingUI = createLoadingUI('app');

const scene = defineScene({
    id: 'scene_with_ui',
    name: '带加载UI的场景',
    resources: {
        textures: {
            'tex1': '/textures/1.jpg',
            'tex2': '/textures/2.jpg'
        }
    },
    onLoadProgress: (loaded, total, percentage) => {
        loadingUI.update(percentage);
    },
    main: async (resources) => {
        loadingUI.remove();
        // 场景逻辑...
    }
});

scene();
```

## 目录结构建议

```
project/
├── src/
│   ├── core/              # 核心系统
│   ├── scenes/            # 场景定义
│   │   ├── level1.ts
│   │   ├── level2.ts
│   │   └── mainMenu.ts
│   ├── assets/            # 资源文件
│   │   ├── textures/
│   │   ├── models/
│   │   ├── shaders/
│   │   └── data/
│   └── index.ts
└── package.json
```

## 常见问题

### Q: 资源加载失败怎么办？

A: 检查：
1. 资源路径是否正确
2. 资源文件是否存在
3. 是否有CORS问题（跨域）
4. 网络连接是否正常

可以在 `onError` 回调中处理：

```typescript
onError: (key, error) => {
    console.error(`资源 ${key} 加载失败:`, error);
    // 使用默认资源或提示用户
}
```

### Q: 如何在场景之间切换？

A: 定义多个场景，然后调用对应的场景函数：

```typescript
const level1 = defineScene({ /* ... */ });
const level2 = defineScene({ /* ... */ });

// 从level1切换到level2
level2();  // 会自动调用level1的onExit
```

### Q: 如何预加载全局资源？

A: 在主场景之前先加载：

```typescript
import { globalResourceLoader, ResourceType } from './core';

// 预加载全局资源
await globalResourceLoader.load({
    resources: [
        { key: 'globalTexture', url: '/global.jpg', type: ResourceType.TEXTURE }
    ]
});

// 然后启动主场景
mainMenu();
```

### Q: 如何清理资源？

A: 在场景的 `onExit` 中清理：

```typescript
onExit: () => {
    // 清理Three.js对象
    scene.traverse((object) => {
        if (object instanceof THREE.Mesh) {
            object.geometry.dispose();
            object.material.dispose();
        }
    });
    
    // 清理加载器中的资源
    resourceLoader.clear('someResourceKey');
}
```

## 下一步

查看完整文档：`资源加载器使用文档.md`

查看示例代码：`src/examples/sceneLoaderDemo.ts`

