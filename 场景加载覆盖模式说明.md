# 场景加载覆盖模式说明

## 更新内容

场景管理器现已支持**覆盖加载模式**，解决了同时加载多个场景时的冲突问题。

## 原问题

之前当一个场景正在加载时，如果尝试加载另一个场景会出现：
- 控制台警告：`Already loading a scene, please wait...`
- 新场景无法启动
- 导致像 `startTestWithUI()` 这样的函数无法正常显示

## 新行为（覆盖模式）

现在当一个场景正在加载时，如果尝试加载新场景：
1. **自动取消当前加载** - 正在加载的场景会被中断
2. **立即开始加载新场景** - 新场景的加载流程立即启动
3. **控制台提示** - 显示警告信息说明取消了哪个场景

## 技术实现

使用 `AbortController` 机制：
- 每次场景加载都创建一个新的 `AbortController`
- 当新场景加载开始时，调用前一个 `AbortController` 的 `abort()` 方法
- 在加载过程中检查 `aborted` 信号，及时停止已取消的加载

## 示例

```javascript
// 场景1开始加载...
window.startSimpleTest();

// 立即启动场景2（会取消场景1的加载）
window.startTestWithUI();

// 控制台输出：
// [SceneManager] Loading scene: 简单测试场景
// [SceneManager] Cancelling current scene loading to load: test_with_ui
// [SceneManager] Scene loading cancelled: 简单测试场景
// [SceneManager] Loading scene: 带UI测试场景
// [SceneManager] Entering scene: 带UI测试场景
```

## 使用建议

1. **快速切换场景** - 现在可以快速切换场景而无需等待前一个场景加载完成
2. **用户交互** - 适合用户频繁点击不同场景按钮的情况
3. **开发调试** - 方便开发时快速测试不同场景

## 注意事项

1. **资源清理** - 被取消的场景不会调用 `onEnter`，但可能已加载部分资源
2. **异步操作** - 如果场景的 `onExit` 包含异步操作，确保它能正确处理被中断的情况
3. **性能考虑** - 频繁切换场景可能导致不必要的网络请求，建议添加防抖机制

## 相关文件

- `src/core/SceneManager.ts` - 场景管理器核心实现
- `src/examples/testScene.ts` - 测试场景示例

