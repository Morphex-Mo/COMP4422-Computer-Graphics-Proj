# 天空盒实现说明

## 概述

在Fox场景中实现了一个程序化渐变天空盒，从底部的温暖桃色平滑过渡到顶部的天空蓝色。

## 实现方式

### 1. 使用球体几何体

```typescript
const skyboxGeometry = new THREE.SphereGeometry(500, 32, 32);
```

- 半径：500（足够大以包围整个场景）
- 宽度/高度段数：32（提供平滑的表面）

### 2. 自定义Shader材质

使用`THREE.ShaderMaterial`实现渐变效果，支持以下uniform参数：

| Uniform | 类型 | 默认值 | 说明 |
|---------|------|--------|------|
| `topColor` | Color | 0x87ceeb | 天空蓝色（顶部颜色） |
| `bottomColor` | Color | 0xffd7a8 | 温暖桃色（底部颜色） |
| `offset` | float | 33 | Y轴偏移量 |
| `exponent` | float | 0.6 | 渐变曲线指数（控制过渡速度） |

### 3. 渲染设置

```typescript
side: THREE.BackSide  // 从内部观察球体
```

使用`BackSide`渲染模式，使球体从内部可见，形成包围场景的天空盒效果。

## Shader代码解析

### 顶点着色器

```glsl
varying vec3 vWorldPosition;
void main() {
    vec4 worldPosition = modelMatrix * vec4(position, 1.0);
    vWorldPosition = worldPosition.xyz;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
```

- 计算顶点的世界坐标
- 将世界位置传递给片段着色器

### 片段着色器

```glsl
uniform vec3 topColor;
uniform vec3 bottomColor;
uniform float offset;
uniform float exponent;
varying vec3 vWorldPosition;

void main() {
    float h = normalize(vWorldPosition + offset).y;
    gl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h, 0.0), exponent), 0.0)), 1.0);
}
```

- 根据Y轴高度计算颜色混合比例
- 使用`pow()`函数控制渐变曲线
- `mix()`在底部和顶部颜色间插值

## 配合雾效

天空盒的底部颜色(0xffd7a8)与场景雾效颜色保持一致：

```typescript
scene.fog = new THREE.FogExp2(0xffd7a8, 0.1);
```

这样可以实现天空与远处雾气的自然融合。

## 自定义天空盒颜色

你可以在代码中修改这些参数来调整天空效果：

```typescript
topColor: { value: new THREE.Color(0x87ceeb) },    // 修改顶部颜色
bottomColor: { value: new THREE.Color(0xffd7a8) }, // 修改底部颜色
offset: { value: 33 },      // 调整渐变位置
exponent: { value: 0.6 }    // 调整渐变平滑度（值越大，过渡越陡）
```

### 预设方案示例

#### 日落天空
```typescript
topColor: { value: new THREE.Color(0xff6b35) },    // 橙红色
bottomColor: { value: new THREE.Color(0xffd93d) }, // 金黄色
exponent: { value: 0.8 }
```

#### 夜晚天空
```typescript
topColor: { value: new THREE.Color(0x000033) },    // 深蓝色
bottomColor: { value: new THREE.Color(0x1a1a2e) }, // 深紫色
exponent: { value: 0.5 }
```

#### 清晨天空
```typescript
topColor: { value: new THREE.Color(0x87ceeb) },    // 浅蓝色
bottomColor: { value: new THREE.Color(0xffb6c1) }, // 浅粉色
exponent: { value: 0.7 }
```

## 资源清理

天空盒材质已在场景退出时正确清理：

```typescript
skyboxMaterial.dispose(); // 清理天空盒材质
```

## 使用立方体贴图天空盒（可选）

如果你有6张天空盒贴图，可以使用立方体贴图方式：

### 1. 准备资源

在`assets`文件夹中放置6张图片（px, nx, py, ny, pz, nz）

### 2. 在场景配置中加载

```typescript
resources: {
    cubeTextures: {
        'skybox': [
            './assets/skybox/px.jpg', // 右
            './assets/skybox/nx.jpg', // 左
            './assets/skybox/py.jpg', // 上
            './assets/skybox/ny.jpg', // 下
            './assets/skybox/pz.jpg', // 前
            './assets/skybox/nz.jpg', // 后
        ]
    }
}
```

### 3. 应用到场景

```typescript
const skyboxTexture = resources.get('skybox');
scene.background = skyboxTexture;
```

## 优势对比

| 方式 | 优点 | 缺点 |
|------|------|------|
| 程序化渐变（当前） | • 文件小，无需加载资源<br>• 可动态调整颜色<br>• 适合简约风格 | • 效果较简单<br>• 无真实感细节 |
| 立方体贴图 | • 可使用真实照片<br>• 细节丰富<br>• 视觉效果好 | • 需要6张图片资源<br>• 文件大小增加<br>• 加载时间长 |

## 总结

当前实现的程序化天空盒适合项目的动漫卡通风格，与Toon Shader材质搭配效果良好。如果后续需要更真实的环境，可以考虑使用立方体贴图方式。

